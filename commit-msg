#!/bin/sh
# original repo code: https://github.com/realattila/clean_git_commit_message

commit_msg_file=$1
commit_msg=$(cat $commit_msg_file)

template_matched=0

# List of valid commit message prefixes
correctCommitMsgFormat=(
  "â­ feature:"
  "ğŸ› ï¸ fix:"
  "ğŸ”ƒ refactor:"
  "ğŸ’« style:"
  "ğŸ“„ document:"
  "ğŸ§ª test:"
  "ğŸš€ release:"
  "ğŸ—‘ï¸ remove:"
  "ğŸ”¼ upgrade:"
  "ğŸ“¦ add:",
  "ğŸ§¹ chore:"
)


correctCommitMsgTemplate=(
  "â­ feature:{Your message}"
  "ğŸ› ï¸ fix:{Your message}"
  "ğŸ”ƒ refactor:{Your message}"
  "ğŸ’« style:{Your message}"
  "ğŸ“„ document:{Your message}"
  "ğŸ§ª test:{Your message}"
  "ğŸš€ release:{Your message}"
  "ğŸ—‘ï¸ remove:{Your message}"
  "ğŸ”¼ upgrade:{Your message}"
  "ğŸ“¦ add:{Your message}",
  "ğŸ§¹ chore:{Your message}"
)

# Function to check if the commit message starts with one of the prefixes
check_commit_message() {
  local message="$1"
  for prefix in "${correctCommitMsgFormat[@]}"; do
    if [[ "$message" == "$prefix"* ]]; then
      template_matched=1
      break
    fi
  done
}

check_commit_message "$commit_msg"

if [ $template_matched -eq 0 ]; then
  echo "Error: Invalid commit message format. Commit message should start with one of the following prefixes:"
  for prefix in "${correctCommitMsgTemplate[@]}"; do
    echo "  $prefix"
  done
  exit 1
fi
